<div class="container mt-5 pt-5 request-history-container">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-5 p-4 bg-light rounded-3 shadow-sm">
    <h2 class="m-0 text-primary">
      <mat-icon class="me-2">history</mat-icon>
      Service Requests History
    </h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <mat-spinner diameter="50" class="mx-auto"></mat-spinner>
    <p class="mt-3 text-muted">
      <mat-icon class="align-middle me-1">hourglass_top</mat-icon>
      Loading your service requests...
    </p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="alert alert-danger text-center">
    <mat-icon class="align-middle me-1">error_outline</mat-icon>
    {{ error }}
    <button mat-stroked-button color="primary" (click)="loadRequests()" class="ms-2">
      <mat-icon class="align-middle me-1">refresh</mat-icon>
      Try Again
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="showEmptyState && !isLoading && !error" class="text-center py-5">
    <mat-icon class="display-4 text-muted mb-3" style="font-size: 4rem;">description</mat-icon>
    <h4 class="text-muted">No Service Requests Found</h4>
    <p class="text-muted">
      <mat-icon class="align-middle me-1">info</mat-icon>
      You haven't made any service requests yet.
    </p>
  </div>

  <!-- Request List -->
  <div *ngIf="!isLoading && !error && !showEmptyState" class="mb-5">
    <div class="table-responsive rounded-3 overflow-hidden shadow-sm">
      <table class="table table-bordered table-hover align-middle text-center mb-0">
        <thead class="table-primary">
          <tr>
            <th class="py-3">
              <mat-icon class="align-middle me-1">build</mat-icon>
              Service
            </th>
            <th class="py-3">
              <mat-icon class="align-middle me-1">event</mat-icon>
              Date
            </th>
            <th class="py-3">
              <mat-icon class="align-middle me-1">flag</mat-icon>
              Status
            </th>
            <th class="py-3">
              <mat-icon class="align-middle me-1">payments</mat-icon>
              Payment
            </th>
            <th class="py-3">
              <mat-icon class="align-middle me-1">attach_money</mat-icon>
              Amount
            </th>
            <th class="py-3">
              <mat-icon class="align-middle me-1">engineering</mat-icon>
              Artisan
            </th>
          </tr>
        </thead>
        <tbody class="bg-light">
          <tr *ngFor="let request of filteredRequests | slice: pageIndex * pageSize : (pageIndex + 1) * pageSize">
            <td class="py-3">
              <mat-icon class="align-middle me-1">home_repair_service</mat-icon>
              {{ request.serviceName || 'Unknown Service' }}
            </td>
            <td class="py-3">
              <mat-icon class="align-middle me-1">calendar_today</mat-icon>
              {{ request.createdAt | date:'mediumDate' }}
            </td>
            <td class="py-3">
              <span class="status-badge d-inline-flex align-items-center justify-content-center gap-2 py-2 px-3 fw-bold"
                    [ngClass]="getStatusClass(request.status)">
                <mat-icon class="status-icon">{{ getStatusIcon(request.status) }}</mat-icon>
                <span class="status-text">{{ getStatusText(request.status) }}</span>
              </span>
            </td>
            <td class="py-3">
              <span *ngIf="request.paymentMethod !== null"
                    class="payment-badge badge rounded-pill d-flex align-items-center gap-2 fw-bold p-2"
                    [ngClass]="getPaymentMethodClass(request.paymentMethod)">
                <mat-icon class="payment-icon">{{ getMethodIcon(request.paymentMethod) }}</mat-icon>
                <span class="payment-text">{{ getMethodText(request.paymentMethod) }}</span>
              </span>
              <span *ngIf="!request.paymentMethod" class="text-muted fw-bold">
                <mat-icon>help_outline</mat-icon>
                <span>Not specified</span>
              </span>
            </td>
            <td class="py-3">
              <mat-icon class="align-middle me-1">paid</mat-icon>
              {{ request.paymentAmount || 'Not specified' }} EGP
            </td>
            <td class="py-3">
              <mat-icon class="align-middle me-1">person</mat-icon>
              {{ request.artisanName || 'Not assigned' }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="mt-5 d-flex justify-content-center">
      <mat-paginator [length]="filteredRequests.length"
                     [pageSize]="pageSize"
                     [pageSizeOptions]="[5, 10, 25, 100]"
                     (page)="onPageChange($event)"
                     color="primary"
                     class="rounded-3 shadow-sm">
      </mat-paginator>
    </div>
  </div>
</div>
